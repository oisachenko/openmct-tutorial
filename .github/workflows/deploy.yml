name: Deploy Deployment
on:
  push:
    branches: [dev]
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: dev
    steps:
      #- name: Checkout
      #  uses: actions/checkout@v2
      - name: Checkout
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.HOST }}
          key: ${{ secrets.HOST_SSH_KEY }}
          username: ${{ secrets.HOST_USERNAME }}
          port: ${{ secrets.HOST_PORT }}
          script: |
            cd /home/ubuntu/expertland
            docker-compose down
            git pull origin
            docker-compose up -d
            docker-compose exec -T app composer install
            docker-compose exec -T app php artisan key:generate
            docker-compose exec -T app php artisan migrate --seed
            docker-compose exec -T app php artisan config:clear
            docker-compose exec -T app php artisan cache:clear
            docker-compose exec -T app npm install
            docker-compose exec -T app npm run build
      #- name: Checkout the repo
      #  uses: actions/checkout@v3
      #  with:
      #    path: '/home/expertland/'
#          pass: ${{ secrets.PASS }}
#          args: "-tt -vvv"
#        env:
#          HOST_PORT: ${{ secrets.HOST_PORT }}
#        with:
#          host: ${{secrets.HOST}}
#          key: ${{secrets.HOST_SSH_KEY}}
#          username: ${{secrets.HOST_USERNAME}}
#          port: $HOST_PORT
#          script: |
#            ls
#            cd /home/ubuntu/expertland/
#            git clone git@github.com:oisachenko/openmct-tutorial.git
#            echo 'Deployment successful'
